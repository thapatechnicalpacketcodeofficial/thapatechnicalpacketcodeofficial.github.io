if(typeof wink=="undefined"){wink={}}wink.version="wo_1.2.1",wink.api={};wink.fx={};wink.math={};wink.mm={};wink.net={};wink.ui={form:{},layout:{},xy:{},xyz:{}};wink.ux={};wink.byId=function(a){if(this.isString(a)){return document.getElementById(a)}else{return a}},wink.translate=function(b,a){try{if(this.isSet(a)){var d=a.i18n}else{var d=i18n}var f=d[b];if(this.isUndefined(f)){f=b}return f}catch(c){return b}};wink.isUndefined=function(a){return(a===undefined)};wink.isNull=function(a){return(a===null)};wink.isSet=function(a){return((!this.isUndefined(a))&&(!this.isNull(a)))};wink.isset=function(a){wink.log("wink.isset is deprecated : must use wink.isSet");return this.isSet(a)};wink.isCallback=function(a){return !!(a&&a.method)};wink.isString=function(a){return(typeof a=="string"||a instanceof String)};wink.isInteger=function(a){return(parseInt(a)===a)};wink.isNumber=function(a){return(typeof a=="number"||a instanceof Number)};wink.isArray=function(a){return(typeof a=="array"||a instanceof Array)};wink.isBoolean=function(a){return(typeof a=="boolean"||a instanceof Boolean)};wink.trim=function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")};wink.bind=function(b,a){return function(){return b.apply(a,arguments)}};wink.call=function(f,d){var c=window;var e=f.method;var b=[];if(this.isSet(f.context)){c=f.context}if(arguments.length==2){b=[d]}if(wink.isSet(f.arguments)){var a=f.arguments;if(!wink.isArray(a)){a=[f.arguments]}b=b.concat(a)}c[e].apply(c,b)};wink.setTimeout=function(d,e,b){var a=Array.prototype.slice.call(arguments,3);var c=function(){d[e].apply(d,a)};return setTimeout(c,b)};wink.setInterval=function(d,e,b){var a=Array.prototype.slice.call(arguments,3);var c=function(){d[e].apply(d,a)};return setInterval(c,b)};wink.getUId=function(){return(new Date().getTime()-Math.ceil(Math.random()*1000))};if(wink.isUndefined(window._)){_=wink.bind(wink.translate,wink)}if(wink.isUndefined(window.$)){$=wink.bind(wink.byId,wink)}wink.topics={_subscribed_topics:[],subscribe:function(a,c){if(!wink.isCallback(c)){wink.log("[topics] invalid callback argument");return}var b=[a.toLowerCase(),c];this._subscribed_topics.push(b)},unsubscribe:function(b,d){var a=this._subscribed_topics;for(var c=0;c<a.length;c++){if(a[c][0]==b.toLowerCase()&&a[c][1].method==d.method&&a[c][1].context==d.context){a.splice(c,1)}}this._subscribed_topics=a},publish:function(a,b){this._dispatch(a.toLowerCase(),b)},_dispatch:function(b,d){var a=this._subscribed_topics;for(var c=0;c<a.length;c++){if(a[c]&&a[c][0]==b){if(wink.isSet(a[c][1])){wink.call(a[c][1],d)}}}}};wink.publish=wink.bind(wink.topics.publish,wink.topics);wink.subscribe=wink.bind(wink.topics.subscribe,wink.topics);wink.unsubscribe=wink.bind(wink.topics.unsubscribe,wink.topics);wink.net.Xhr=function(a){this.uId=wink.getUId();this.request={xhrObject:null,params:a};this._create()};wink.net.Xhr.prototype={sendData:function(c,q,a,g,f,h){var b=this.request,n=b.xhrObject,k=encodeURIComponent;a=a.toUpperCase();if(wink.isSet(q)&&!wink.isArray(q)){wink.log("[Xhr] parameters must be in an array of objects containing the parameter name and value");return}if(n){var d=null;if(wink.isSet(q)){var j=q.length;for(var m=0;m<j;m++){if(m==0){if(a=="GET"){c+="?"+k(q[m].name)+"="+k(q[m].value)}else{d=k(q[m].name)+"="+k(q[m].value)}}else{if(a=="GET"){c+="&"+k(q[m].name)+"="+k(q[m].value)}else{d+="&"+k(q[m].name)+"="+k(q[m].value)}}}}try{n.open(a,c,true);n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8");if(wink.isSet(h)){if(!wink.isArray(h)){wink.log("[Xhr] headers must be in an array of objects containing the header name and value")}else{var j=h.length;for(var m=0;m<j;m++){n.setRequestHeader(h[m].name,h[m].value)}}}n.send(d)}catch(o){return false}n.onreadystatechange=function(){if(n.readyState==4&&!((n.status>=200&&n.status<400)||n.status==0)){if(wink.isSet(f)){wink.call(f,b)}}if(n.readyState==4&&((n.status>=200&&n.status<400)||n.status==0)){if(wink.isSet(g)){wink.call(g,b)}}}}else{return false}return true},_create:function(){if(window.XMLHttpRequest){var a;try{a=new XMLHttpRequest()}catch(b){a=false}this.request.xhrObject=a}else{wink.log("[Xhr] XHR not supported")}}};wink.Xhr=wink.net.Xhr;wink.json={parse:function(str){if(wink.isSet(window.JSON)&&wink.isSet(window.JSON.parse)){return window.JSON.parse(str)}else{var JSON=!(/[^,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t]/.test(str.replace(/"(\\.|[^"\\])*"/g,"")))&&eval("("+str+")");return JSON}},concat:function(c,b){for(var a in b){c[a]=b[a]}}};wink.parseJSON=wink.bind(wink.json.parse,wink.json);wink.json.concat(wink.json,{_stack:new Array(),stringify:function(a){var b;if(a){if(wink.isSet(window.JSON)&&wink.isSet(window.JSON.stringify)){b=window.JSON.stringify(a)}else{b=wink.json._str(a)}}return b},_str:function(b){var c;var a="";var d=new Object();if(b&&wink.isSet(b.toJSON)){c=b.toJSON();if(wink.isString(c)){c=this._quote(c)}}else{if(wink.isString(b)){c=this._quote(b)}else{if(wink.isNumber(b)){c=(isFinite(b))?b:"null"}else{if(wink.isNull(b)){c="null"}else{if(wink.isBoolean(b)){c=(b)?"true":"false"}else{if(!wink.isUndefined(b)&&typeof(b)!="function"){c=(wink.isArray(b))?this._JA(b):this._JO(b)}}}}}}return c},_quote:function(e){function c(g){var f={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(!f[g]){f[g]="\\u"+("0000"+(+(g.charCodeAt(0))).toString(16)).slice(-4)}return f[g]}var d='"',a=e,b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;e=a.replace(b,c);e=d+e+d;return e},_JO:function(c){var b=new Array(),k=new Array();for(var e=0;e<this._stack.length;e++){if(this._stack[e]==c){wink.log("[JSON] The passed value is a cyclical structure.");return undefined}}this._stack.push(c);for(var h in c){b.push(h)}var a,d,f=",",g=":";for(var e=0;e<b.length;e++){a=this._str(c[b[e]]);if(!wink.isUndefined(a)){d=this._quote(b[e])+g+a;k.push(d)}}if(k.length==0){str="{}"}else{var j="";for(var e=0;e<k.length;e++){j+=k[e]+f}j=j.slice(0,-1);str="{"+j+"}"}this._stack.pop();return str},_JA:function(g){var a=new Array(),d=",",f;for(var c=0;c<this._stack.length;c++){if(this._stack[c]==g){wink.log("[JSON] The passed value is a cyclical structure.");return undefined}}this._stack.push(g);var e;for(var c=0;c<g.length;c++){e=this._str(g[c]);a.push((wink.isUndefined(e))?"null":e)}if(a.length==0){f="[]"}else{var b="";for(var c=0;c<a.length;c++){b+=a[c]+d}b=b.slice(0,-1);f="["+b+"]"}this._stack.pop();return f}});wink.error={logLevel:0,log:function(a){if(this.logLevel==1){if(console!=undefined){console.log(a)}else{alert(a)}}}};wink.log=wink.bind(wink.error.log,wink.error);if(typeof orangesearch=="undefined"){orangesearch={}}if(typeof orangesearch.completion=="undefined"){orangesearch.completion={}}if(typeof orangesearch.completion.plugin=="undefined"){orangesearch.completion.plugin={}}var Component=function(a){Component.count+=1;this._abortSubmit=false;this._abortDisplay=false;this.additionalParams=null;this.applyDelayOnMouseOver=0;this.blocks=[];this._currentBlocks=[];this.alternativeBlocks={};this._cacheActivated=true;this._callbacks=[];this.changeOnMouseOver=false;this.checkInput=true;this.clearAccents=false;this.clearSeparatorChars=false;this.closeCompletionOnBlur=true;this._completionDiv=null;this._completionDivId=null;this._completionSet=false;this._completionCloseLink=false;this._completionDivContainer=null;this.completionDivUnrollDelay=0;this.cssPrefix="";this._currentFieldValue="";this.debugMode=false;this.defaultBlockLabel="Suggestions";this.defaultBlockBaseId=-1;this._disableOnBlur=true;this.field=null;this._fieldForm=null;this._highlightedSuggestionIndex=0;this.isFormSubmit=true;this.maxNbChar=40;this.maxNbSuggestions=10;this.minQueryLength=1;this.nameOfInstanceForJsonP=false;this._uid=Component.count;this._oldInputFieldValue="";this.plugins=[];this._positionReference=null;this._properties={};this.queryParamName="kw";this._resultCache=null;this._serviceStatus="";this._selectedSuggestionIndex=0;this._started=false;this.submitCallback=null;this._suggestionsList=new orangesearch.completion.SuggestionList();this._suggestionPrefixId="completionResultLine_";this.useBoldInCompletion=true;this.url=null;this.onClickCompletion=false;this.onClickCompletionKeyword="basic";this.onClickCompletionId="0";this._onClickCompletionUrl="";this._xhrManager=new wink.Xhr();if(a){this.setProperties(a)}return this};Component.count=0;Component.prototype={keyCode:{keyBad:0,keyOtherEnter:3,keyTab:9,keyEnter:13,keyShift:16,keyAlt:18,keyCapsLock:20,keyEscape:27,keyLeft:37,keyUp:38,keyRight:39,keyDown:40},setProperties:function(a){if(this._started){wink.log("The autocompleter is started, you can not set properties");return false}if(wink.isUndefined(a)||wink.isNull(a)){wink.log("You try to set invalid properties");return false}this._properties=a;return true},start:function(){if(this._started){wink.log("Error : Completion already started");return}if(!this._initProperties()){return false}this._initPlugins();this._initPluginProperties();this._initPluginFieldListeners();this._initSubscriptions();this._started=true},restart:function(a){if(!a){return false}if(a.plugins){wink.log("Property plugins cannot be changed while restarting. Please create a new autocompleter if you want load others plugins.");return false}this._started=false;this.emptyCompletionResults();this.setProperties(a);if(!this._initProperties()){return false}this._initPluginProperties();this._initPluginFieldListeners();this._started=true},isStarted:function(){return this._started},enable:function(){if(!this._completionSet){wink.log("Completion has not been set correctly");return}this._initFieldListeners();this._initPluginFieldListeners();this.enableCompletionDisplay()},disable:function(){this.hideCompletionDiv();this.field.onkeydown=null;this.field.onkeyup=null;this.field.onclick=null;this._disableOnBlur=true;this.disableCompletionDisplay()},disableCompletionDisplay:function(){this._abortDisplay=true},enableCompletionDisplay:function(){this._abortDisplay=false},_initFieldListeners:function(){this._disableOnBlur=false;this.field.onkeydown=this.manageFieldOnKeyDown;this.field.onkeyup=this.manageFieldOnKeyUp;if(this.onClickCompletion){this.field.onclick=this.manageFieldOnClick}else{this.field.onclick=null}},_initPluginFieldListeners:function(){for(var a=0;a<this.plugins.length;a++){if(this.plugins[a].initFieldListeners){this.plugins[a].initFieldListeners();break}}},_initOnBlurListener:function(){var b=this.field.onblur;var a=this.manageFieldOnBlur;if(b){this.field.onblur=function(c){b(c);a(c)}}else{this.field.onblur=a}},_initFormListener:function(){if(this._fieldForm){var c=this._fieldForm.onsubmit;var a=this.manageFormOnSubmit;var b=this;if(c){this._fieldForm.onsubmit=function(d){if(!a(b,d,{})|!c(d)){return false}}}else{this._fieldForm.onsubmit=function(d){return a(b,d,{})}}}},_initDom:function(){if(this._positionReference){this._positionReference.parentNode.removeChild(this._positionReference)}if(this._completionDiv){orangesearch.tools.addStyleForElement(this._completionDiv,this.getCssPrefix()+"AutoCompleteCompletionBox");this._positionReference=null;this._completionDiv.style.visibility="hidden";this._completionDiv.style.display="none";return true}this._positionReference=document.createElement("div");orangesearch.tools.addStyleForElement(this._positionReference,this.getCssPrefix()+"AutoCompleteReferenceBox");this._positionReference.style.position="relative";this._positionReference.style.margin="0";this._positionReference.style.padding="0";this._positionReference.style.width="0";this._positionReference.style.height="0";this.field.parentNode.insertBefore(this._positionReference,this.field);this._completionDivContainer=document.createElement("div");orangesearch.tools.addStyleForElement(this._completionDivContainer,this.getCssPrefix()+"AutoCompleteContainerBox");this._completionDivContainer.style.position="absolute";this._completionDivContainer.style.margin="0";this._completionDivContainer.style.padding="0";this._completionDivContainer.style.border="0";this._completionDivContainer.style.top=this.field.offsetHeight+"px";this._positionReference.appendChild(this._completionDivContainer);this._completionDiv=document.createElement("div");if(this._completionDivId){this._completionDiv.setAttribute("id",this._completionDivId)}else{this._completionDiv.setAttribute("id","divCompletion_"+this._uid)}orangesearch.tools.addStyleForElement(this._completionDiv,this.getCssPrefix()+"AutoCompleteCompletionBox");this._completionDiv.style.position="relative";this._completionDiv.style.visibility="hidden";this._completionDiv.style.display="none";this._completionDivContainer.appendChild(this._completionDiv);return true},_initDefaultSubscriptions:function(){return true},_initPlugins:function(){if(!this._properties.plugins){return false}var a=null;for(var b=0;b<this._properties.plugins.length;b++){if(!orangesearch.completion.plugin[this._properties.plugins[b]]){wink.log("The plugin "+this._properties.plugins[b]+" does not exists !");continue}a=new orangesearch.completion.plugin[this._properties.plugins[b]]();if(!a){wink.log("The plugin "+this._properties.plugins[b]+" does not exists !");continue}if(a.canBeUsed){if(!a.canBeUsed()){continue}}a.setCompletionComponent(this);if(a.initPlugin){a.initPlugin()}this.plugins.push(a)}return true},_initSubscriptions:function(){this._initDefaultSubscriptions();for(var a=0;a<this.plugins.length;a++){if(this.plugins[a].initSubscription){this.plugins[a].initSubscription()}}return true},_initPluginProperties:function(){for(var a=0;a<this.plugins.length;a++){if(this.plugins[a].initProperties){this.plugins[a].initProperties()}}return true},setDebugMode:function(a){if(!wink.error){return false}if(a){this.debugMode=true;wink.error.logLevel=1}else{this.debugMode=false;wink.error.logLevel=0}},_initProperties:function(){if(!this._properties){wink.log("properties array is missing");return false}var b=false;var a=false;var c=false;if(!wink.isUndefined(this._properties.url)){if(!this._properties.url){wink.log("property 'url' cannot be null");return false}this.url=this._properties.url;b=true}else{if(!this.url){wink.log("property 'url' is missing");return false}}if(!wink.isUndefined(this._properties.field)){if(!this._properties.field){wink.log("property 'field' cannot be null");return false}if(!this.field||this.field!=this._properties.field){this.field=this._properties.field;if(this.field.form&&this._fieldForm!=this.field.form){this._fieldForm=this.field.form;this._initFormListener()}this._initOnBlurListener();callInitFieldListenerFunction=true}this.field.autoCompleter=this}else{if(!this.field){wink.log("property 'field' is missing");return false}}if(!wink.isUndefined(this._properties.onClickCompletion)){this.onClickCompletion=this._properties.onClickCompletion;c=true}if(!wink.isUndefined(this._properties.divCompletion)){if(typeof this._properties.divCompletion=="object"){this._completionDiv=this._properties.divCompletion}else{if(typeof this._properties.divCompletion=="string"){this._completionDiv=wink.byId(this._properties.divCompletion)}else{this._completionDiv=null}}a=true}else{if(!this._completionDiv){a=true}}if(this._properties.blocks){this.blocks=this._properties.blocks;b=true}if(this._properties.alternativeBlocks){this.alternativeBlocks=this._properties.alternativeBlocks}if(this._properties.callbacks){this._callbacks=this._properties.callbacks}if(this._properties.nameOfInstanceForJsonP){this.nameOfInstanceForJsonP=this._properties.nameOfInstanceForJsonP}if(this._properties.onClickCompletionKeyword){this.onClickCompletionKeyword=this._properties.onClickCompletionKeyword}if(this._properties.onClickCompletionId){this.onClickCompletionId=this._properties.onClickCompletionId}if(!wink.isUndefined(this._properties.checkInput)){this.checkInput=this._properties.checkInput}if(this._properties.divCompletionId){this._completionDivId=this._properties.divCompletionId}if(this._properties.completionDivUnrollDelay){this.completionDivUnrollDelay=this._properties.completionDivUnrollDelay}if(this._properties.applyDelayOnMouseOver){this.setDelayOnMouseOver(this._properties.applyDelayOnMouseOver)}if(!wink.isUndefined(this._properties.closeCompletionOnBlur)){this.closeCompletionOnBlur=this._properties.closeCompletionOnBlur}if(this._properties.disableCache){this._cacheActivated=false}if(this._properties.queryParamName){this.queryParamName=this._properties.queryParamName;b=true}if(this._properties.additionalParams){this.additionalParams=this._properties.additionalParams;b=true}if(this._properties.cssPrefix){this.cssPrefix=this._properties.cssPrefix}if(this._properties.maxNbChar&&wink.isInteger(this._properties.maxNbChar)>0){this.maxNbChar=this._properties.maxNbChar}if(this._properties.maxNbSuggestions&&wink.isInteger(this._properties.maxNbSuggestions)>0){this.maxNbSuggestions=this._properties.maxNbSuggestions;b=true}if(this._properties.minQueryLength){this.minQueryLength=this._properties.minQueryLength}if(!wink.isUndefined(this._properties.clearAccents)){this.clearAccents=this._properties.clearAccents}if(!wink.isUndefined(this._properties.clearSeparatorChars)){this.clearSeparatorChars=this._properties.clearSeparatorChars}if(this._properties.closeLink){this._completionCloseLink=true}if(this._properties.isFormSubmit===false){this.isFormSubmit=false}if(!wink.isUndefined(this._properties.defaultBlockLabel)){this.defaultBlockLabel=this._properties.defaultBlockLabel}if(!wink.isUndefined(this._properties.defaultBlockBaseId)){this.defaultBlockBaseId=this._properties.defaultBlockBaseId}if(this._properties.changeOnMouseOver){this.changeOnMouseOver=true}if(this._properties.useBoldInCompletion){this.useBoldInCompletion=true}this._resultCache=new Array();if(b){this._initUrl()}if(a){this._initDom()}if(callInitFieldListenerFunction){this._initFieldListeners()}this._completionSet=true;return true},_initOnClickCompletionUrl:function(){this._onClickCompletionUrl=this.url+"?id="+this.onClickCompletionId+"&"+this.queryParamName+"="+this.onClickCompletionKeyword;if(this.nameOfInstanceForJsonP){this._onClickCompletionUrl+="&jsonp="+this.nameOfInstanceForJsonP+".completionCallBack"}},_initUrl:function(){if(!this.blocks||this.blocks.length==0){this.blocks=[{label:this.defaultBlockLabel,baseId:this.defaultBlockBaseId,max:this.maxNbSuggestions}]}if(this.onClickCompletion){this._initOnClickCompletionUrl()}if(this.blocks.length==1){var b=this.blocks[0].baseId?this.blocks[0].baseId:this.defaultBlockBaseId;var e=this.blocks[0].max?this.blocks[0].max:this.maxNbSuggestions;this.url=this.url+"?id="+b+"&an="+e}else{var f=[];var a=[];for(var d=0,c=0;d<this.blocks.length;d++){if(!this.blocks[d].baseId){continue}if(!this.blocks[d].max){this.blocks[d].max=this.maxNbSuggestions}f[c]=this.blocks[d].baseId;a[c]="an"+(c+1)+"="+this.blocks[d].max;c++}this.url=this.url+"?id="+f.join(",")+"&an="+this.maxNbSuggestions+"&"+a.join("&")}var g=this.additionalParams?"&"+this.additionalParams:"";this.url+=g;if(this.nameOfInstanceForJsonP){this.url+="&jsonp="+this.nameOfInstanceForJsonP+".completionCallBack"}return true},_unHighlightAllSuggestions:function(){if(this.getSizeOfSuggestionsList()<=0){return}for(var a=1;a<=this.getSizeOfSuggestionsList();a++){orangesearch.tools.removeStyleForElement(wink.byId(this.getSuggestionPrefix()+a),this.getCssPrefix()+"AutoCompleteHighlightedSuggestion");orangesearch.tools.addStyleForElement(wink.byId(this.getSuggestionPrefix()+a),this.getCssPrefix()+"AutoCompleteSuggestion")}},resetCompletion:function(){if(this.checkInput){if(this._currentFieldValue==""||this.getSizeOfSuggestionsList()==0){this.hideCompletionDiv()}}wink.publish("/callback/resetCompletion/reset",{uid:this._uid});this._unHighlightAllSuggestions();this._highlightedSuggestionIndex=0;this._selectedSuggestionIndex=0},manageDivOnMouseDown:function(c,b,a){c.field.value=c.getSuggestionParam(a.id,"v");c._currentFieldValue=c.field.value;c._selectedSuggestionIndex=c._highlightedSuggestionIndex;c.hideCompletionDiv();c.pushFieldCursor();if(c.field.form){c.callSubmit(b)}},manageDivOnMouseOver:function(d,c,b){if(d.applyDelayOnMouseOver){var a=d.getSuggestionParam(b.id,"index");d._highlightedSuggestionIndex=a;setTimeout(function(){d.checkDivOnMouseOverSuggestion(a,c,b)},d.applyDelayOnMouseOver)}else{d.highlightNewValueOnMouseOver(c,b)}},checkDivOnMouseOverSuggestion:function(a,c,b){if(this._highlightedSuggestionIndex==a&&document.activeElement==this.field){this.highlightNewValueOnMouseOver(c,b)}},highlightNewValueOnMouseOver:function(c,b){var a=this.getSuggestionParam(b.id,"index");if(!a){return}this._cursorUpDownPressed=false;this.highlightNewValue(a);if(this.changeOnMouseOver){this.field.value=this.getSuggestionParam(b.id,"v");this._selectedSuggestionIndex=this._highlightedSuggestionIndex}},highlightNewValueOnKeyDown:function(a){this.highlightNewValue(a);this._selectedSuggestionIndex=this._highlightedSuggestionIndex;if(this._highlightedSuggestionIndex>0){var b=this.getSuggestionParam(this._getSuggestionId(this._highlightedSuggestionIndex),"v");if(b){this.field.value=b}}},manageDivOnMouseOut:function(c,b,a){if(c.changeOnMouseOver){c.field.value=c._currentFieldValue}},_getSuggestionId:function(a){if(!a){return null}return this.getSuggestionPrefix()+a},_getSuggestionDiv:function(a){if(!a){return null}return wink.byId(this._getSuggestionId(a))},isSelectedSuggestion:function(){return(this._selectedSuggestionIndex>0)},callSubmit:function(a,b){if(this.manageFormOnSubmit(this,a,b)){this.field.form.submit()}},manageFormOnSubmit:function(f,e,g){f.hideCompletionDiv();orangesearch.tools.focusOnInputEnd(f.field);f._abortSubmit=false;wink.publish("/callback/manageFormOnSubmit/beforeSubmit",{uid:f._uid,autoCompleter:f,event:e,query:f.field.value});if(f._abortSubmit){f._abortSubmit=false;return false}var b=f._highlightedSuggestionIndex;if(!wink.isSet(g)||typeof g!="object"){g={}}g.id=f.field.id;g.div=f._getSuggestionDiv(b);g.query=f.field.value;if(b>0){var d=f.getSuggestionParam(f._getSuggestionId(b),"v");var c=f.getSuggestionParam(f._getSuggestionId(b),"blockId");if(f._currentBlocks[c].submitCallback&&f._currentFieldValue==d){var a=wink.callAndReturn(f._currentBlocks[c].submitCallback,g);if(a===false){return false}}}if(f._callbacks&&f._callbacks.submit&&wink.isCallback(f._callbacks.submit)){var a=wink.callAndReturn(f._callbacks.submit,g);if(a===false){return false}}if(!f.isFormSubmit){return false}return true},manageFieldOnClick:function(a){if(this.value.length>0){return}if(!a&&window.event){a=window.event}if(!a){return false}return this.autoCompleter.defaultFieldOnClickCallBack(a)},defaultFieldOnClickCallBack:function(b){if(this.nameOfInstanceForJsonP){orangesearch.tools.writeScript(this._onClickCompletionUrl,"jsonCompletionCallBackScriptId")}else{var a={context:this,method:"completionCallBack"};var c={context:this,method:"completionFailureCallBack"};this._xhrManager.sendData(url,null,"GET",a,c,null)}},manageFieldOnKeyUp:function(a){if(!a&&window.event){a=window.event}if(!a){return false}return this.autoCompleter.defaultFieldOnKeyUpCallBack(a)},defaultFieldOnKeyUpCallBack:function(d){switch(d.keyCode){case this.keyCode.keyAlt:case this.keyCode.keyCapsLock:case this.keyCode.keyTab:case this.keyCode.keyBad:case this.keyCode.keyEnter:case this.keyCode.keyOtherEnter:case this.keyCode.keyShift:return;case this.keyCode.keyEscape:this.field.value=this._currentFieldValue;this.hideCompletionDiv();return;case this.keyCode.keyDown:case this.keyCode.keyUp:this._cursorUpDownPressed=true;this.pushFieldCursor();break;default:this._cursorUpDownPressed=false;this._currentFieldValue=this.field.value;break}this._currentFieldValue=orangesearch.tools.cleanQuery(this._currentFieldValue);if(this._oldInputFieldValue!=this._currentFieldValue){var f=encodeURIComponent(this._currentFieldValue);if(f!=""&&f.length>=this.minQueryLength&&typeof(f)!="undefined"){var e=this._resultCache[this._currentFieldValue.substring(0,this._currentFieldValue.length-1)];if(!e||e.length!=0){var b=this._resultCache[this._currentFieldValue];if(b){this._currentJsonResultsData=b;this.displayCompletionResults(this._currentFieldValue)}else{var c=this.url+"&"+this.queryParamName+"="+f;if(this.nameOfInstanceForJsonP){orangesearch.tools.writeScript(c,"jsonCompletionCallBackScriptId")}else{var a={context:this,method:"completionCallBack"};var g={context:this,method:"completionFailureCallBack"};this._xhrManager.sendData(c,null,"GET",a,g,null)}this.field.focus()}}else{this.addCacheResult(this._currentFieldValue,new Array());this.hideCompletionDiv()}}else{this.hideCompletionDiv()}}this._oldInputFieldValue=this._currentFieldValue},manageFieldOnKeyDown:function(a){if(!a&&window.event){a=window.event}if(!a){return false}return this.autoCompleter.defaultFieldOnKeyDownCallBack(a)},defaultFieldOnKeyDownCallBack:function(a){switch(a.keyCode){case this.keyCode.keyDown:this.highlightNewValueOnKeyDown(this._highlightedSuggestionIndex+1);break;case this.keyCode.keyUp:this.highlightNewValueOnKeyDown(this._highlightedSuggestionIndex-1);break;case this.keyCode.keyEnter:case this.keyCode.keyOtherEnter:case this.keyCode.keyAlt:case this.keyCode.keyCapsLock:case this.keyCode.keyTab:case this.keyCode.keyBad:case this.keyCode.keyShift:break;case this.keyCode.keyEscape:this.resetCompletion();break;default:if(!this.onClickCompletion){this.resetCompletion()}return}},manageFieldOnBlur:function(a){if(!this.autoCompleter){return}if(!this.autoCompleter.closeCompletionOnBlur){return}if(this.autoCompleter._disableOnBlur){return}if(!this.autoCompleter._cursorUpDownPressed){this.autoCompleter.hideCompletionDiv()}this.autoCompleter._cursorUpDownPressed=false},highlightNewValue:function(a){if(this.getSizeOfSuggestionsList()==0){return}this.showCompletionDiv();this._unHighlightAllSuggestions();if(a<0){a=this.getSizeOfSuggestionsList()}else{if(a>this.getSizeOfSuggestionsList()){a=0}}if(a==0){this.field.value=this._currentFieldValue;this._highlightedSuggestionIndex=0}else{this._highlightedSuggestionIndex=a;if(this._highlightedSuggestionIndex>0){orangesearch.tools.removeStyleForElement(this._getSuggestionDiv(this._highlightedSuggestionIndex),this.getCssPrefix()+"AutoCompleteSuggestion");orangesearch.tools.addStyleForElement(this._getSuggestionDiv(this._highlightedSuggestionIndex),this.getCssPrefix()+"AutoCompleteHighlightedSuggestion");this._completionDiv.scrollTop=a*this._getSuggestionDiv(this._highlightedSuggestionIndex).offsetHeight}}wink.publish("/callback/highlightNewValue/suggestionHighlighted",{uid:this._uid,div:this._getSuggestionDiv(this._highlightedSuggestionIndex),index:this._highlightedSuggestionIndex})},completionCallBack:function(a){if(this._abortDisplay){return}var b=null;if(this.nameOfInstanceForJsonP){b=a}else{if(!a.xhrObject.responseText){return}b=wink.parseJSON(a.xhrObject.responseText)}if(!b.serviceStatus||wink.isUndefined(b.data)||wink.isUndefined(b.query)){return}switch(b.serviceStatus){case"SUSPENDED":case"KO_CONFIG":case"KO_PARSE":case"KO_MISC":case"LOCK":this.disable();return;break;case"NO_STATUS":case"TO":case"KO_HTTP":case"KO_CONNECT":this._currentJsonResultsData=this.getEmptyResultTemplate();break;default:this.addCacheResult(b.query,b.data);this._currentJsonResultsData=b.data;break}if(b.blocks){this.displayCompletionResults(b.query,b.blocks)}else{if(this._currentFieldValue==b.query){this.displayCompletionResults(b.query)}}},getEmptyResultTemplate:function(){var b=[];for(var a=0;a<this.blocks.length;a++){b.push([])}return b},completionFailureCallBack:function(){return},addCacheResult:function(b,a){if(!b){return}if(this._cacheActivated==true){this._resultCache[b]=a}},_getNewBlockLabel:function(c,b){var a=document.createElement("div");a.id="blockLabel"+b+"_"+this.getUid()+"_"+c;var e=this._currentBlocks[c]["type"];orangesearch.tools.addStyleForElement(a,this.getCssPrefix()+"AutoCompleteBlockLabel"+b);if(!e){this.populateNewBlockLabel(a,c,b);return a}for(var d=0;d<this.plugins.length;d++){if(this.plugins[d].isValidType(e)){this.plugins[d].populateNewBlockLabel(a,c,b);return a}}wink.log("Error: The plugin "+e+" has not been found in the list of loaded plugins !");return null},populateNewBlockLabel:function(b,d,a){var e=document.createElement("div");orangesearch.tools.addStyleForElement(e,this.getCssPrefix()+"AutoCompleteBlockLabelBasicContent"+a);var c="label";if(a=="Bottom"){c="bottomLabel"}if(this._currentBlocks[d][c]){e.innerHTML=this._currentBlocks[d][c]}b.appendChild(e)},_getNewSuggestionRow:function(c,b,a){var e=document.createElement("div");orangesearch.tools.addStyleForElement(e,this.getCssPrefix()+"AutoCompleteSuggestion");e.id=this.getSuggestionPrefix()+a;var f=b.t;if(this.clearAccents){b.v=orangesearch.tools.stripAccents(b.v)}if(this.clearSeparatorChars){b.v=orangesearch.tools.stripSeparatorChars(b.v)}if(b.d&&b.d["params"]){this.addSuggestionParam(e.id,"params",b.d["params"])}for(var d=0;d<this.plugins.length;d++){if(this.plugins[d].isValidType(f)){this.plugins[d].populateNewSuggestionRow(c,e,b,a);this.plugins[d].addEventListenerOnNewSuggestionRow(e);return e}}if(f){wink.log("Error: The plugin "+f+" has not been found in the list of loaded plugin !")}this.populateNewSuggestionRow(c,e,b,a);this.addEventListenerOnNewSuggestionRow(e);return e},populateNewSuggestionRow:function(e,f,b,a){var c=document.createElement("span");orangesearch.tools.addStyleForElement(c,this.getCssPrefix()+"AutoCompleteSuggestionContent");var d=b.v;if(!wink.isString(d)){d=""}d=d.cutString(this.maxNbChar);if(this.useBoldInCompletion){c.innerHTML=orangesearch.tools.getBoldInv(d,e,this.clearAccents,this.clearSeparatorChars)}else{c.innerHTML=d}if(this.debugMode&&b.d&&b.d["baseId"]){c.innerHTML="["+b.d["baseId"]+"] "+c.innerHTML}this.addSuggestionParam(f.id,"v",b.v);this.addSuggestionParam(f.id,"t",b.t);this.addSuggestionParam(f.id,"d",b.d);f.appendChild(c)},addEventListenerOnNewSuggestionRow:function(b){var a=this;b.onmousedown=function(c){a.manageDivOnMouseDown(a,c,this)};b.onmouseover=function(c){a.manageDivOnMouseOver(a,c,this)};b.onmouseout=function(c){a.manageDivOnMouseOut(a,c,this)}},_getBottomActionBar:function(){var c=document.createElement("div");orangesearch.tools.addStyleForElement(c,this.getCssPrefix()+"AutoCompleteBottomActionBar");for(var e=0;e<this.plugins.length;e++){if(this.plugins[e].getBottomAction){var b=this.plugins[e].getBottomAction();if(b){b.style.display="inline-block";b.style.cssFloat="right";b.style.styleFloat="right";c.appendChild(b)}}}var d=this;var a=document.createElement("a");a.innerHTML="Fermer";a.style.display="inline-block";a.onclick=function(f){d.hideCompletionDiv()};orangesearch.tools.addStyleForElement(a,this.getCssPrefix()+"AutoCompleteBottomActionClose");c.appendChild(a);return c},displayCompletionResults:function(e,d){this._currentBlocks=this.blocks;if(typeof d!="undefined"&&d.length>0){if(this.alternativeBlocks[d]){this._currentBlocks=this.alternativeBlocks[d]}}wink.publish("/callback/displayCompletionResults/beforeDisplay",{uid:this._uid,query:e});this.emptyCompletionResults();var c=this._currentJsonResultsData;if(this._checkNotEmptyList(c)){this.showCompletionDiv();var a=1;var b=0;var f=0;this._addNewSuggestionRowRecursive(e,f,c,b,a);this.showCompletionDiv()}else{this.hideCompletionDiv()}},_checkNotEmptyList:function(b){if(!b||b.length<=0){return false}if(this.checkInput&&!this.onClickCompletion){if(this.field.value==""){return false}}for(var a=0;a<b.length;a++){if(b[a].length>0){return true}}return false},_addNewSuggestionRowRecursive:function(g,h,f,d,a){if(d>=this._currentBlocks.length){return this._finalizeCompletionConstruction(a)}if(!f[d]||f[d].length==0){d++;h=0;return this._addNewSuggestionRowRecursive(g,h,f,d,a)}if(h==0){if(!wink.isUndefined(this._currentBlocks[d]["label"])){var c=this._getNewBlockLabel(d,"Top");if(!c){d++;return this._addNewSuggestionRowRecursive(g,h,f,d,a)}this._completionDiv.appendChild(c)}}var b=this._getNewSuggestionRow(g,f[d][h],a);if(!b){return}this.addSuggestionParam(b.id,"blockId",d);this.addSuggestionParam(b.id,"index",a);this._completionDiv.appendChild(b);if(this.completionDivUnrollDelay&&this.completionDivUnrollDelay>0){var e=this;setTimeout(function(){e._publishNewSuggestionRow(g,b,h,f,d,a)},this.completionDivUnrollDelay)}else{this._publishNewSuggestionRow(g,b,h,f,d,a)}},_publishNewSuggestionRow:function(f,c,g,e,d,a){wink.publish("/callback/displayCompletionResults/elementAdded",{uid:this._uid,position:a,div:c,data:e[d][g]});a++;g++;if(g>=e[d].length){if(!wink.isUndefined(this._currentBlocks[d]["bottomLabel"])){var b=this._getNewBlockLabel(d,"Bottom");if(b){this._completionDiv.appendChild(b)}}g=0;d++}this._addNewSuggestionRowRecursive(f,g,e,d,a)},_finalizeCompletionConstruction:function(a){if(this._completionCloseLink){this._completionDiv.appendChild(this._getBottomActionBar())}this.resetCompletion();wink.publish("/callback/displayCompletionResults/allElementsAdded",{uid:this._uid,position:a});return true},emptyCompletionResults:function(){if(!this._completionDiv){return}this.resetSuggestionsList();while(this._completionDiv.childNodes.length>0){this._completionDiv.removeChild(this._completionDiv.childNodes[0])}},showCompletionDiv:function(){if(!this._completionDiv){return}if(this._completionDiv.style.visibility=="visible"||this._completionDiv.style.display=="block"){return}if(this._callbacks&&this._callbacks.show&&wink.isCallback(this._callbacks.show)){wink.call(this._callbacks.show)}wink.publish("/callback/showCompletionDiv/show",{uid:this._uid});if(this._completionDiv){this._completionDiv.style.display="block";this._completionDiv.style.visibility="visible"}},hideCompletionDiv:function(){if(!this._completionDiv){return}if(this._completionDiv.style.visibility=="hidden"){return}if(this._callbacks&&this._callbacks.hide&&wink.isCallback(this._callbacks.hide)){wink.call(this._callbacks.hide)}wink.publish("/callback/hideCompletionDiv/hide",{uid:this._uid});if(this._completionDiv){this._completionDiv.style.display="none";this._completionDiv.style.visibility="hidden"}},pushFieldCursor:function(){if(this.field.value){oldValue=this.field.value;this.field.value="";this.field.value=oldValue}},enableCache:function(){this._cacheActivated=true},disableCache:function(){this._cacheActivated=false},getSuggestionPrefix:function(){return this._suggestionPrefixId+this._uid+"_"},getHighlightedSuggestionIndex:function(){return this._highlightedSuggestionIndex},getSelectedSuggestionIndex:function(){return this._selectedSuggestionIndex},setDelayOnMouseOver:function(a){var b=orangesearch.tools.integerValue(a);if(!b||b<=0){this.applyDelayOnMouseOver=0}else{this.applyDelayOnMouseOver=b}},getDelayOnMouseOver:function(){if(this.applyDelayOnMouseOver){return this.applyDelayOnMouseOver}return 0},hasPositionReference:function(){if(this._positionReference){return true}return false},getPositionReference:function(){return this._positionReference},getCompletionDiv:function(){return this._completionDiv},getCssPrefix:function(){return this.cssPrefix},getUid:function(){return this._uid},abortSubmit:function(){this._abortSubmit=true},updateCurrentFieldValue:function(){this._currentFieldValue=this.field.value},updateSelectedIndex:function(){this._selectedSuggestionIndex=this._highlightedSuggestionIndex},hasForm:function(){if(this.field.form){return true}return false},setCheckInputValue:function(a){this.checkInput=a},addSuggestionParam:function(b,a,c){this._suggestionsList.addSuggestionParam(b,a,c)},getSuggestionParam:function(b,a){return this._suggestionsList.getSuggestionParam(b,a)},getAllSuggestionParams:function(a){return this._suggestionsList.getAllSuggestionParams(a)},getSizeOfSuggestionsList:function(){return this._suggestionsList.getSize()},getSuggestionsList:function(){return this._suggestionsList.getAllSuggestions()},resetSuggestionsList:function(){this._suggestionsList.resetAllParams()}};orangesearch.completion.Component=Component;wink.callAndReturn=function(f,d){var c=window;var e=f.method;var b=[];if(this.isSet(f.context)){c=f.context}if(arguments.length==2){b=[d]}if(wink.isSet(f.arguments)){var a=f.arguments;if(!wink.isArray(a)){a=[f.arguments]}b=b.concat(a)}return c[e].apply(c,b)};var SuggestionList=function(){this._size=0;this._suggestions={}};SuggestionList.prototype={addSuggestionParam:function(b,a,c){if(!this._suggestions[b]){this._suggestions[b]={};this._size++}this._suggestions[b][a]=c},getSuggestionParam:function(b,a){if(!b){return null}if(!this._suggestions[b]||wink.isUndefined(this._suggestions[b][a])){return null}return this._suggestions[b][a]},getAllSuggestionParams:function(a){if(!a){return null}if(wink.isUndefined(this._suggestions[a])){return null}return this._suggestions[a]},resetAllParams:function(){this._size=0;this._suggestions={}},getSize:function(){return this._size},getAllSuggestions:function(){return this._suggestions}};orangesearch.completion.SuggestionList=SuggestionList;orangesearch.tools={arrayKeyExists:function(b,a){if(!a||(a.constructor!==Array&&a.constructor!==Object)){return false}return a[b]!==undefined},integerValue:function(b){var a=typeof(b);if(a==="number"){return b}else{if(a==="string"){return parseInt(b)}else{if(a==="boolean"){return(b)?1:0}else{return 0}}}},ucFirst:function(a){if(a.length>0){return a.charAt(0).toUpperCase()+a.substring(1)}else{return a}},lcFirst:function(a){if(a.length>0){return a.charAt(0).toLowerCase()+a.substring(1)}else{return a}},clone:function(c){var a=(c instanceof Array)?[]:{};for(var b in c){if(c[b]&&typeof c[b]=="object"){a[b]=orangesearch.tools.clone(c[b])}else{a[b]=c[b]}}return a},stripAccents:function(f){f=f.replace("/\xC3\xA9/g","e");f=f.replace("/\xC3\xA8/g","e");f=f.replace("/\xC3\xAA/g","e");f=f.replace("/\xC3\xAB/g","e");f=f.replace("/\xC3\xA0/g","a");f=f.replace("/\xC3\xA2/g","a");f=f.replace("/\xC3\xA4/g","a");f=f.replace("/\xC3\xAC/g","i");f=f.replace("/\xC3\xAE/g","i");f=f.replace("/\xC3\xAF/g","i");f=f.replace("/\xC3\xB4/g","o");f=f.replace("/\xC3\xB6/g","o");f=f.replace("/\xC3\xB2/g","o");f=f.replace("/\xC3\xBB/g","u");f=f.replace("/\xC3\xBC/g","u");f=f.replace("/\xC3\xB9/g","u");f=f.replace("/\xC3\xA7/g","c");f=f.replace("/\xC3\xB1/g","n");f=f.replace("/\xC3\xBF/g","y");var d="\xE0\xE2\xE4\xE1\xC0\xC1\xC4\xC2\xEB\xE8\xE9\xEA\xCA\xC9\xC8\xCB\xEF\xEE\xED\xEC\xCC\xCD\xCE\xCF\xF2\xF3\xF4\xF6\xD2\xD3\xD4\xD6\xFC\xF9\xFB\xFA\xDA\xD9\xDB\xDC\xE3\xF5\xF1\xC3\xD5\xD1\xE7";var c="aaaaAAAAeeeeEEEEiiiiIIIIooooOOOOuuuuUUUUaonAONc";for(var e=0;e<d.length;e++){f=f.split(d.charAt(e)).join(c.charAt(e))}return f},stripSeparatorChars:function(a){return a.replace(/[-._']/g," ")},cleanQuery:function(a){return a.toLowerCase().replace(/[ ]+/g," ").replace(/^ /,"")},clearSpace:function(a){return a.toLowerCase().replace(/[ ]+/g," ").replace(/^ /,"").replace(/ $/,"")},focusOnInputEnd:function(c){c.focus();if(this.setSelectionRange){var a=c.value.length*2;this.setSelectionRange(a,a)}else{var b=c.value;c.value="";c.value=b}},writeScript:function(d,c){var e=document.getElementsByTagName("head")[0];var b=document.createElement("script");if(document.getElementById(c)){var a=document.getElementById(c);e.removeChild(a);b.setAttribute("id",c);b.setAttribute("type","text/javascript");b.setAttribute("src",d);e.appendChild(b)}else{b.setAttribute("id",c);b.setAttribute("type","text/javascript");b.setAttribute("src",d);e.appendChild(b)}},getBoldInv:function(j,g,f,c){var h="";if(wink.isUndefined(g)||g.length==0){return"<b>"+j+"</b>"}g=this.clearSpace(g);var e=this.stripAccents(this.stripSeparatorChars(g)).toLowerCase();var a=this.stripAccents(this.stripSeparatorChars(j)).toLowerCase();if(c&&f){j=this.stripAccents(this.stripSeparatorChars(j))}else{if(c){j=this.stripSeparatorChars(j)}else{if(f){j=this.stripAccents(j)}}}var b=0;var d=a.indexOf(e,b);while(d!=-1){if((d==0)||a.charAt(d-1)==" "){if(d>b){h+="<b>"+j.substring(b,d)+"</b>"}var b=d+e.length;h+=j.substring(d,b)}else{h+="<b>"+j.substring(b,d+e.length)+"</b>";var b=d+e.length}var d=a.indexOf(e,b)}if(a.length>b){h+="<b>"+j.substring(b)+"</b>"}return h},addStyleForElement:function(c,b){if(!c){return}var a=c.className;if((" "+a+" ").indexOf(" "+b+" ")<0){c.className=a+(a?" ":"")+b}},removeStyleForElement:function(c,a){if(!c){return}var b=wink.trim((" "+c.className+" ").replace(" "+a+" "," "));if(c.className!=b){c.className=b}},hasStyleForElement:function(c,b){if(!c){return false}var a=c.className;if((" "+a+" ").indexOf(" "+b+" ")>=0){return true}return false},fullDate:function(){var c=new Array("janvier","f&eacute;vrier","mars","avril","mai","juin","juillet","ao&ucirc;t","septembre","octobre","novembre","d&eacute;cembre");var b=new Array("dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi");var a=new Date;return b[a.getDay()]+" "+a.getDate()+" "+c[a.getMonth()]+" "+a.getFullYear()},getNowDay:function(){var a=new Date();var b="";switch(a.getDay()){case 0:b="dimanche";break;case 1:b="lundi";break;case 2:b="mardi";break;case 3:b="mercredi";break;case 4:b="jeudi";break;case 5:b="vendredi";break;case 6:b="samedi";break}return b},getNowDate:function(){var a=new Date();str=a.getDate()+" ";switch(a.getMonth()){case 0:str+="janvier";break;case 1:str+="f&eacute;vrier";break;case 2:str+="mars";break;case 3:str+="avril";break;case 4:str+="mai";break;case 5:str+="juin";break;case 6:str+="juillet";break;case 7:str+="aout";break;case 8:str+="septembre";break;case 9:str+="octobre";break;case 10:str+="novembre";break;case 11:str+="d&eacute;cembre";break}return str},getSimpleFavIconUrl:function(a){if(!a||a.length<=0){return"error"}if(a.substr(0,7)!="http://"){a="http://"+a}return a+"/favicon.ico"},stopEvent:function(a){if(a.stopPropagation){a.stopPropagation()}if(a.preventDefault){a.preventDefault()}a.cancelBubble=true;a.returnValue=false},setOpacity:function(c,b){var a=wink.byId(b);if(!a){return}a.style.opacity=(c/100);a.style.MozOpacity=(c/100);a.style.KhtmlOpacity=(c/100);a.style.filter="alpha(opacity="+c+")"}};if(!String.prototype.cutString){String.prototype.cutString=function(a){if(a>0&&this.length>a){return this.substring(0,a-1)+"&hellip;"}else{return this}}}var Plugin=function(){this.completionComponent=null;return this};Plugin._extendPluginChildren=[];Plugin.prototype={setCompletionComponent:function(a){this.completionComponent=a},getTypeOfSuggestion:function(){return null},populateNewBlockLabel:function(a,b){this.completionComponent.populateNewBlockLabel(a,b)},populateNewSuggestionRow:function(c,d,b,a){this.completionComponent.populateNewSuggestionRow(c,d,b,a)},addEventListenerOnNewSuggestionRow:function(a){this.completionComponent.addEventListenerOnNewSuggestionRow(a)},extendFromPlugin:function(b){if(Plugin._extendPluginChildren[b]){return true}for(var a in orangesearch.completion.plugin.Plugin.prototype){if("extendFromPlugin"==a){continue}if(!b.prototype[a]){b.prototype[a]=orangesearch.completion.plugin.Plugin.prototype[a]}}Plugin._extendPluginChildren[b]=true;return true}};orangesearch.completion.plugin.Plugin=Plugin;var DirectLink=function(){orangesearch.completion.plugin.Plugin.call(this);new orangesearch.completion.plugin.Plugin().extendFromPlugin(orangesearch.completion.plugin.DirectLink);this.displayUrlAsTitle=false;this._currentLink="";this._textAppend="&nbsp;&nbsp;(acc&egrave;s direct)";return this};DirectLink.prototype={getTypeOfSuggestion:function(){return"link"},isValidType:function(a){return(a==this.getTypeOfSuggestion())},initProperties:function(){if(this.completionComponent._properties.displayUrlAsTitle){this.displayUrlAsTitle=this.completionComponent._properties.displayUrlAsTitle}if(!wink.isUndefined(this.completionComponent._properties.directLinkTextAppend)){this._textAppend=this.completionComponent._properties.directLinkTextAppend}},initSubscription:function(){wink.subscribe("/callback/manageFormOnSubmit/beforeSubmit",{context:this,method:"checkDirectLinks"})},populateNewSuggestionRow:function(d,f,b,a){if(this.displayUrlAsTitle&&b.d&&b.d["display_url"]){b.v=b.d["display_url"]}else{if(b.d&&b.d["title"]){b.v=b.d["title"]}}this.completionComponent.populateNewSuggestionRow(d,f,b,a);if(f.firstChild){orangesearch.tools.addStyleForElement(f.firstChild,this.completionComponent.getCssPrefix()+"DirectLink");var e=document.createElement("span");e.innerHTML=this._textAppend;orangesearch.tools.addStyleForElement(e,this.completionComponent.getCssPrefix()+"DirectLinkText");f.appendChild(e)}if(b.d["url"]){this.completionComponent.addSuggestionParam(f.id,"url",b.d["url"]);var c=document.createElement("div");orangesearch.tools.addStyleForElement(c,this.completionComponent.getCssPrefix()+"AutoCompleteDirectLinkAnchor");f.insertBefore(c,f.firstChild)}},checkDirectLinks:function(c){if(c.uid!=this.completionComponent.getUid()){return false}var a=this.completionComponent._getSuggestionId(this.completionComponent._selectedSuggestionIndex);if(this.completionComponent.getSuggestionParam(a,"t")!==this.getTypeOfSuggestion()){return false}var b=this.completionComponent.getSuggestionParam(a,"url");if(!b){return false}this.completionComponent.resetCompletion();this.completionComponent.abortSubmit();document.location=b;return true}};orangesearch.completion.plugin.DirectLink=DirectLink;var Petale=function(){orangesearch.completion.plugin.Plugin.call(this);new orangesearch.completion.plugin.Plugin().extendFromPlugin(orangesearch.completion.plugin.Petale);this._identifierOfElement=[];this._idOfElement=[];this._petaleDdata=[];this._petaleDataTypes=["O","M","V"];this._petaleDataType="O";this._petaleThematics={boutique:"mboutique",people:"mpeople",shopping:"mshopping",meteo:"mmeteo"};this._smoothShow=false;this._smoothShowDelay=20;this._smoothShowIncrement=3;this._petaleInfoSize=50;this._petaleTitleSize=25;this._petaleDefaultImages={};this._borderBottomOfCompletionContainer=0;this._navigateInPetale=false;this._justExit=false;this._currentPetaleId=0;this._currentPetaleLinkId=0;this._petaleContainerIdentifier="petaleContainerId_";this._petaleSubContainerIdentifier="petaleSubContainerId_";this._petaleContainerCssClass="PetaleContainer";this._petaleContainerTitleCssClass="PetaleContainerTitle";this._petaleSubContainerCssClass="PetaleSubContainer";this._petaleReferenceContainerCssClass="PetaleReferenceContainer";this._petaleReferenceContainerFullCssClass="PetaleReferenceFullContainer";this._petaleSubReferenceContainerCssClass="PetaleSubReferenceContainer";this._petaleSubReferenceContainerFullCssClass="PetaleSubReferenceFullContainer";this._petaleReferenceImageTableCssClass="PetaleReferenceImageTable";this._petaleReferenceImageTrCssClass="PetaleReferenceImageTr";this._petaleReferenceImageTdCssClass="PetaleReferenceImageTd";this._petaleReferenceImageContainerCssClass="PetaleReferenceImageContainer";this._petaleReferenceImageCssClass="PetaleReferenceImage";this._petaleReferenceInfoContainerCssClass="PetaleReferenceInfoContainer";this._petaleReferenceInfoTopContainerCssClass="PetaleReferenceInfoTopContainer";this._petaleReferenceInfoCssClass="PetaleReferenceInfo";this._petaleReferenceUrlDisplayCssClass="PetaleReferenceUrlDisplay";this._petaleReferenceUrlDisplayFaviconCssClass="PetaleReferenceUrlDisplayFavicon";this._petaleActionLinkContainerCssClass="PetaleActionLinkContainer";this._petaleActionLinkSeparatorCssClass="PetaleActionLinkSeparator";this._petaleActionLinkCssClass="PetaleActionLink";this._petaleActionUrlDisplayCssClass="PetaleActionUrlDisplay";this._petaleActionUrlDisplayTextCssClass="PetaleActionUrlDisplayText";this._petaleActionTextCssClass="PetaleActionText";this._petaleGeneralActionOverCssClass="PetaleGeneralActionOver";return this};Petale.prototype={canBeUsed:function(){return !("ontouchstart" in document.documentElement)},getTypeOfSuggestion:function(){return"petale"},isValidType:function(a){return(a==this.getTypeOfSuggestion())},populateNewSuggestionRow:function(e,c,b,a){if(b.d["links"]||b.d["ref"]){var d=document.createElement("div");orangesearch.tools.addStyleForElement(d,this.completionComponent.getCssPrefix()+"AutoCompleteChevron");c.appendChild(d)}this.completionComponent.populateNewSuggestionRow(e,c,b,a)},initProperties:function(){if(!wink.isUndefined(this.completionComponent._properties.petaleSmoothShow)){this._smoothShow=this.completionComponent._properties.petaleSmoothShow}if(!wink.isUndefined(this.completionComponent._properties.petaleSmoothShowDelay)&&wink.isInteger(this.completionComponent._properties.petaleSmoothShowDelay)){this._smoothShowDelay=this.completionComponent._properties.petaleSmoothShowDelay}if(!wink.isUndefined(this.completionComponent._properties.petaleSmoothShowIncrement)&&wink.isInteger(this.completionComponent._properties.petaleSmoothShowIncrement)){this._smoothShowIncrement=this.completionComponent._properties.petaleSmoothShowIncrement}if(!wink.isUndefined(this.completionComponent._properties.petaleBorderBottomOfContainer)&&wink.isInteger(this.completionComponent._properties.petaleBorderBottomOfContainer)){this._borderBottomOfCompletionContainer=this.completionComponent._properties.petaleBorderBottomOfContainer}if(!wink.isUndefined(this.completionComponent._properties.petaleImageWidthHeight)){this.petaleImageWidthHeight=this.completionComponent._properties.petaleImageWidthHeight}if(!wink.isUndefined(this.completionComponent._properties.petaleInfoSize)&&this.completionComponent._properties.petaleInfoSize>3){this._petaleInfoSize=this.completionComponent._properties.petaleInfoSize}if(!wink.isUndefined(this.completionComponent._properties.petaleTitleSize)&&this.completionComponent._properties.petaleTitleSize>3){this._petaleTitleSize=this.completionComponent._properties.petaleTitleSize}if(!wink.isUndefined(this.completionComponent._properties.petaleDataType)){this._petaleDataType=this.completionComponent._properties.petaleDataType}if(!wink.isUndefined(this.completionComponent._properties.petaleDataTypes)){this._petaleDataTypes=this.completionComponent._properties.petaleDataTypes}if(!wink.isUndefined(this.completionComponent._properties.petaleThematics)){this._petaleThematics=this.completionComponent._properties.petaleThematics}if(!wink.isUndefined(this.completionComponent._properties.petaleDefaultImages)){this._petaleDefaultImages=this.completionComponent._properties.petaleDefaultImages}},initPlugin:function(){var a=document.createElement("div");a.style.position="relative";a.style.width="0px";a.style.height="0px";a.style.margin="0px";a.style.padding="0px";a.style.zIndex="910";a.style.cssFloat="left";a.style.styleFloat="left";if(this._petaleDivObjectContainer){if(this.completionComponent.hasPositionReference()){this.completionComponent.getPositionReference().parentNode.removeChild(this._petaleDivObjectContainer)}else{this.completionComponent.getCompletionDiv().parentNode.removeChild(this._petaleDivObjectContainer)}}this._petaleDivObjectContainer=a;if(this.completionComponent.hasPositionReference()){this.completionComponent.getPositionReference().parentNode.insertBefore(a,this.completionComponent.getPositionReference())}else{this.completionComponent.getCompletionDiv().parentNode.insertBefore(a,this.completionComponent.getCompletionDiv())}},initSubscription:function(){wink.subscribe("/callback/highlightNewValue/suggestionHighlighted",{context:this,method:"highLightPetaleElement"});wink.subscribe("/callback/displayCompletionResults/elementAdded",{context:this,method:"_savePositionForPetaleSuggestion"});wink.subscribe("/callback/displayCompletionResults/allElementsAdded",{context:this,method:"_createAllPetaleElementsCall"});wink.subscribe("/callback/hideCompletionDiv/hide",{context:this,method:"hideAllPetaleElements"});wink.subscribe("/callback/resetCompletion/reset",{context:this,method:"hideAllPetaleElements"});wink.subscribe("/callback/displayCompletionResults/beforeDisplay",{context:this,method:"_resetPetaleData"})},initFieldListeners:function(){var a=this;this.completionComponent.field.onkeydown=function(b){return a.manageFieldOnKeyDown(b)};this.completionComponent.field.onkeyup=function(b){return a.manageFieldOnKeyUp(b)}},manageFieldOnKeyUp:function(a){if(!a&&window.event){a=window.event}if(!a||!a.keyCode){return false}if(this._justExit||this._navigateInPetale){this._justExit=false;if(a.keyCode==this.completionComponent.keyCode.keyDown||a.keyCode==this.completionComponent.keyCode.keyUp||a.keyCode==this.completionComponent.keyCode.keyLeft||a.keyCode==this.completionComponent.keyCode.keyRight||a.keyCode==this.completionComponent.keyCode.keyEnter){return false}}return this.completionComponent.defaultFieldOnKeyUpCallBack(a)},manageFieldOnKeyDown:function(a){if(!a&&window.event){a=window.event}if(!a||!a.keyCode){return false}switch(a.keyCode){case this.completionComponent.keyCode.keyRight:if(this._enterInPetaleContainer(a)){return true}break;case this.completionComponent.keyCode.keyLeft:if(this._exitFromPetaleContainer(a)){return true}break;case this.completionComponent.keyCode.keyUp:if(this._upInPetaleContainer(a)){return true}break;case this.completionComponent.keyCode.keyDown:if(this._downInPetaleContainer(a)){return true}break;case this.completionComponent.keyCode.keyEnter:if(this._validateInPetaleContainer(a)){return true}break;default:break}return this.completionComponent.defaultFieldOnKeyDownCallBack(a)},_enterInPetaleContainer:function(e){if(this._navigateInPetale){return true}var b=this.completionComponent.getHighlightedSuggestionIndex();if(!b){return false}var d=wink.byId(this._petaleContainerIdentifier+b);if(!d){return false}var c=this.completionComponent.getSuggestionParam(this.completionComponent.getSuggestionPrefix()+b,"linkCount");if(!c){return false}var a=wink.byId("petaleActionLink_"+b+"_1");if(!a){return false}this._navigateInPetale=true;this._currentPetaleId=b;this._currentPetaleLinkId=1;orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleGeneralActionOverCssClass);return true},_exitFromPetaleContainer:function(c){if(!this._navigateInPetale){return false}if(!this._currentPetaleId||!this._currentPetaleLinkId){return false}var a=wink.byId("petaleActionLink_"+this._currentPetaleId+"_"+this._currentPetaleLinkId);if(!a){return false}orangesearch.tools.removeStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleGeneralActionOverCssClass);this._currentPetaleId=0;this._currentPetaleLinkId=0;this._justExit=true;var b=this;setTimeout(function(){b._navigateInPetale=false;orangesearch.tools.focusOnInputEnd(b.completionComponent.field)},30);return true},_upInPetaleContainer:function(d){if(!this._navigateInPetale){return false}if(!this._currentPetaleId||!this._currentPetaleLinkId){return false}var c=this.completionComponent.getSuggestionParam(this.completionComponent.getSuggestionPrefix()+this._currentPetaleId,"linkCount");if(!c){return false}var b=this._currentPetaleLinkId-1;if(b<1){b=c}if(b==this._currentPetaleLinkId){return true}var a=wink.byId("petaleActionLink_"+this._currentPetaleId+"_"+this._currentPetaleLinkId);if(!a){return false}orangesearch.tools.removeStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleGeneralActionOverCssClass);this._currentPetaleLinkId=b;a=wink.byId("petaleActionLink_"+this._currentPetaleId+"_"+this._currentPetaleLinkId);if(!a){return false}orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleGeneralActionOverCssClass);return true},_downInPetaleContainer:function(d){if(!this._navigateInPetale){return false}if(!this._currentPetaleId||!this._currentPetaleLinkId){return false}var c=this.completionComponent.getSuggestionParam(this.completionComponent.getSuggestionPrefix()+this._currentPetaleId,"linkCount");if(!c){return false}var b=this._currentPetaleLinkId+1;if(b>c){b=1}if(b==this._currentPetaleLinkId){return true}var a=wink.byId("petaleActionLink_"+this._currentPetaleId+"_"+this._currentPetaleLinkId);if(!a){return false}orangesearch.tools.removeStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleGeneralActionOverCssClass);this._currentPetaleLinkId=b;a=wink.byId("petaleActionLink_"+this._currentPetaleId+"_"+this._currentPetaleLinkId);if(!a){return false}orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleGeneralActionOverCssClass);return true},_validateInPetaleContainer:function(b){if(!this._navigateInPetale){return false}if(!this._currentPetaleId||!this._currentPetaleLinkId){return false}this._justExit=true;var a=this.completionComponent.getSuggestionParam(this.completionComponent.getSuggestionPrefix()+this._currentPetaleId,"link_url_action_"+this._currentPetaleLinkId);if(a){orangesearch.tools.stopEvent(b);setTimeout(function(){document.location=a},250)}return true},_dataHasUrl:function(b){for(var a=0;a<this._petaleDataTypes.length;a++){if(b["url"+this._petaleDataTypes[a]]&&b["url"+this._petaleDataTypes[a]].length>0){return true}}return false},_dataHasUrlDisplay:function(b){for(var a=0;a<this._petaleDataTypes.length;a++){if(b["urlDisplay"+this._petaleDataTypes[a]]&&b["urlDisplay"+this._petaleDataTypes[a]].length>0){return true}}return false},_getBestDataUrl:function(b){if(b["url"+this._petaleDataType]&&b["url"+this._petaleDataType].length>0){return b["url"+this._petaleDataType]}for(var a=0;a<this._petaleDataTypes.length;a++){if(b["url"+this._petaleDataTypes[a]]&&b["url"+this._petaleDataTypes[a]].length>0){return b["url"+this._petaleDataTypes[a]]}}return false},_getBestDataUrlDisplay:function(b){if(b["urlDisplay"+this._petaleDataType]&&b["urlDisplay"+this._petaleDataType].length>0){return b["urlDisplay"+this._petaleDataType]}for(var a=0;a<this._petaleDataTypes.length;a++){if(b["urlDisplay"+this._petaleDataTypes[a]]&&b["urlDisplay"+this._petaleDataTypes[a]].length>0){return b["urlDisplay"+this._petaleDataTypes[a]]}}return null},_getFormattedText:function(b,a){if(b.length>a){return b.substring(0,a-3)+"..."}return b},createOnePetaleElement:function(d,e){var b=this.completionComponent;var c=this;var a=this._petaleThematics.people;if(e.d["them"]){a=e.d["them"].toLowerCase()}switch(a){case this._petaleThematics.meteo:this._createMeteoPetaleElement(b,c,d,e);break;case this._petaleThematics.shopping:this._createShoppingPetaleElement(b,c,d,e);break;case this._petaleThematics.boutique:this._createBoutiquePetaleElement(b,c,d,e);break;case this._petaleThematics.people:default:this._createPeoplePetaleElement(b,c,d,e);break}},_createPetaleContainer:function(e,f,b){this.completionComponent.addSuggestionParam(this._idOfElement[e],"them",b);var c=document.createElement("div");orangesearch.tools.addStyleForElement(c,this.completionComponent.getCssPrefix()+this._petaleContainerCssClass);c.id=this._petaleContainerIdentifier+this._identifierOfElement[e];this._petaleDivObjectContainer.appendChild(c);var a=document.createElement("div");orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleContainerTitleCssClass);if(f.d["title"]){a.innerHTML=this._getFormattedText(f.d["title"],this._petaleTitleSize);a.title=f.d["title"]}else{a.innerHTML="&nbsp;"}c.appendChild(a);var d=document.createElement("div");orangesearch.tools.addStyleForElement(d,this.completionComponent.getCssPrefix()+this._petaleSubContainerCssClass);d.id=this._petaleSubContainerIdentifier+this._identifierOfElement[e];c.appendChild(d);return d},_createPetaleReferenceContainer:function(f,a,g,c){var d=this.completionComponent;var e=this;var b=document.createElement("div");if(a){orangesearch.tools.addStyleForElement(b,this.completionComponent.getCssPrefix()+this._petaleReferenceContainerCssClass);orangesearch.tools.addStyleForElement(b,this.completionComponent.getCssPrefix()+this._petaleReferenceContainerCssClass+"_"+c)}else{orangesearch.tools.addStyleForElement(b,this.completionComponent.getCssPrefix()+this._petaleReferenceContainerFullCssClass);orangesearch.tools.addStyleForElement(b,this.completionComponent.getCssPrefix()+this._petaleReferenceContainerFullCssClass+"_"+c)}if(g!==false){b.id="petaleActionLink_"+this._identifierOfElement[f]+"_1";b.onmouseover=function(){orangesearch.tools.addStyleForElement(this,d.getCssPrefix()+e._petaleGeneralActionOverCssClass)};b.onmouseout=function(){orangesearch.tools.removeStyleForElement(this,d.getCssPrefix()+e._petaleGeneralActionOverCssClass)};b.onclick=(function(h){return function(i){orangesearch.tools.removeStyleForElement(this,d.getCssPrefix()+e._petaleGeneralActionOverCssClass);window.location.href=h}})(g);this.completionComponent.addSuggestionParam(this._idOfElement[f],"link_url_action_1",g)}return b},_createPetaleReferenceSubContainer:function(a,b){var c=document.createElement("div");if(a){orangesearch.tools.addStyleForElement(c,this.completionComponent.getCssPrefix()+this._petaleSubReferenceContainerCssClass);orangesearch.tools.addStyleForElement(c,this.completionComponent.getCssPrefix()+this._petaleSubReferenceContainerCssClass+"_"+b)}else{orangesearch.tools.addStyleForElement(c,this.completionComponent.getCssPrefix()+this._petaleSubReferenceContainerFullCssClass);orangesearch.tools.addStyleForElement(c,this.completionComponent.getCssPrefix()+this._petaleSubReferenceContainerFullCssClass+"_"+b)}return c},_createPetaleReferenceUrl:function(d,f,h,a){var c=document.createElement("div");orangesearch.tools.addStyleForElement(c,this.completionComponent.getCssPrefix()+this._petaleReferenceUrlDisplayCssClass);orangesearch.tools.addStyleForElement(c,this.completionComponent.getCssPrefix()+this._petaleReferenceUrlDisplayCssClass+"_"+a);if(h&&h.length>0){var e=this._getBestDataUrlDisplay(f.d["ref"]);if(e){var g=document.createElement("img");orangesearch.tools.addStyleForElement(g,this.completionComponent.getCssPrefix()+this._petaleReferenceUrlDisplayFaviconCssClass);g.src=orangesearch.tools.getSimpleFavIconUrl(e);g.onerror=function(){this.parentNode.removeChild(this)};c.appendChild(g)}}var b=document.createElement("span");b.innerHTML=this._getBestDataUrlDisplay(f.d["ref"]);c.appendChild(b);return c},_createPetaleActionLinks:function(c,k,a,l){var j=this.completionComponent;var f=this;if(a!==false){this.completionComponent.addSuggestionParam(this._idOfElement[c],"linkCount",k.d["links"].length+1)}else{this.completionComponent.addSuggestionParam(this._idOfElement[c],"linkCount",k.d["links"].length)}var b=document.createElement("div");orangesearch.tools.addStyleForElement(b,this.completionComponent.getCssPrefix()+this._petaleActionLinkContainerCssClass);orangesearch.tools.addStyleForElement(b,this.completionComponent.getCssPrefix()+this._petaleActionLinkContainerCssClass+"_"+l);var p=1;if(a!==false){p++}for(var e=0;e<k.d["links"].length;e++){if(!k.d["links"][e]["act"]||!k.d["links"][e]["type"]||!this._dataHasUrlDisplay(k.d["links"][e])||!this._dataHasUrl(k.d["links"][e])){continue}var h=document.createElement("div");orangesearch.tools.addStyleForElement(h,this.completionComponent.getCssPrefix()+this._petaleActionLinkSeparatorCssClass);orangesearch.tools.addStyleForElement(h,this.completionComponent.getCssPrefix()+this._petaleActionLinkSeparatorCssClass+"_"+l);b.appendChild(h);var n=document.createElement("div");n.id="petaleActionLink_"+this._identifierOfElement[c]+"_"+p;orangesearch.tools.addStyleForElement(n,this.completionComponent.getCssPrefix()+this._petaleActionLinkCssClass);orangesearch.tools.addStyleForElement(n,this.completionComponent.getCssPrefix()+this._petaleActionLinkCssClass+"_"+l);n.onmouseover=function(){orangesearch.tools.addStyleForElement(this,j.getCssPrefix()+f._petaleGeneralActionOverCssClass)};n.onmouseout=function(){orangesearch.tools.removeStyleForElement(this,j.getCssPrefix()+f._petaleGeneralActionOverCssClass)};var d=document.createElement("div");orangesearch.tools.addStyleForElement(d,this.completionComponent.getCssPrefix()+k.d["links"][e]["type"]+"ActionClass");var m=this._getBestDataUrl(k.d["links"][e]);this.completionComponent.addSuggestionParam(this._idOfElement[c],"link_url_"+(e+1),m);n.onclick=(function(i){return function(){orangesearch.tools.removeStyleForElement(this,j.getCssPrefix()+f._petaleGeneralActionOverCssClass);window.location.href=i}})(m);this.completionComponent.addSuggestionParam(this._idOfElement[c],"link_url_action_"+p,m);var o=document.createElement("span");o.innerHTML=k.d["links"][e]["act"];orangesearch.tools.addStyleForElement(o,this.completionComponent.getCssPrefix()+this._petaleActionTextCssClass);d.appendChild(o);n.appendChild(d);var g=document.createElement("div");orangesearch.tools.addStyleForElement(g,this.completionComponent.getCssPrefix()+this._petaleActionUrlDisplayCssClass);var o=document.createElement("span");o.innerHTML=this._getBestDataUrlDisplay(k.d["links"][e]);orangesearch.tools.addStyleForElement(o,this.completionComponent.getCssPrefix()+this._petaleActionUrlDisplayTextCssClass);g.appendChild(o);n.appendChild(g);b.appendChild(n);p++}return b},_createPetaleImage:function(c,h,f){var i=document.createElement("table");orangesearch.tools.addStyleForElement(i,this.completionComponent.getCssPrefix()+this._petaleReferenceImageTableCssClass);orangesearch.tools.addStyleForElement(i,this.completionComponent.getCssPrefix()+this._petaleReferenceImageTableCssClass+"_"+f);i.cellPadding=0;i.cellSpacing=0;var d=i.insertRow(-1);orangesearch.tools.addStyleForElement(d,this.completionComponent.getCssPrefix()+this._petaleReferenceImageTrCssClass);orangesearch.tools.addStyleForElement(d,this.completionComponent.getCssPrefix()+this._petaleReferenceImageTrCssClass+"_"+f);var g=d.insertCell(-1);orangesearch.tools.addStyleForElement(g,this.completionComponent.getCssPrefix()+this._petaleReferenceImageTdCssClass);orangesearch.tools.addStyleForElement(g,this.completionComponent.getCssPrefix()+this._petaleReferenceImageTdCssClass+"_"+f);var e=document.createElement("div");orangesearch.tools.addStyleForElement(e,this.completionComponent.getCssPrefix()+this._petaleReferenceImageContainerCssClass);orangesearch.tools.addStyleForElement(e,this.completionComponent.getCssPrefix()+this._petaleReferenceImageContainerCssClass+"_"+f);var b=false;if(c._petaleDefaultImages&&c._petaleDefaultImages["default"]){b=c._petaleDefaultImages["default"]}if(c._petaleDefaultImages&&c._petaleDefaultImages[f]){b=c._petaleDefaultImages[f]}var a=document.createElement("img");orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleReferenceImageCssClass);if(typeof h=="string"&&h.length>0){a.src=h;orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleReferenceImageCssClass+"_"+f)}else{if(b){a.src=b}orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleReferenceImageCssClass+"_"+f+"_default")}a.onerror=function(){if(b){this.src=b}orangesearch.tools.removeStyleForElement(this,c.completionComponent.getCssPrefix()+c._petaleReferenceImageCssClass+"_"+f);orangesearch.tools.addStyleForElement(this,c.completionComponent.getCssPrefix()+c._petaleReferenceImageCssClass+"_"+f+"_default")};e.appendChild(a);g.appendChild(e);return i},_createPetaleInfos:function(d,f,g,c,h){var b=document.createElement("div");orangesearch.tools.addStyleForElement(b,this.completionComponent.getCssPrefix()+this._petaleReferenceInfoContainerCssClass);orangesearch.tools.addStyleForElement(b,this.completionComponent.getCssPrefix()+this._petaleReferenceInfoContainerCssClass+"_"+c);d.appendChild(b);var a=document.createElement("div");orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleReferenceInfoTopContainerCssClass);orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+this._petaleReferenceInfoTopContainerCssClass+"_"+c);b.appendChild(a);this._createPetaleBasicInfos(g,a,c);if(this._dataHasUrlDisplay(g.d["ref"])&&h!==false){var e=this._createPetaleReferenceUrl(f,g,h,c);b.appendChild(e)}},_createPetaleBasicInfos:function(f,a,c){for(var b=0;b<f.d["ref"]["info"].length;b++){if(f.d["ref"]["info"][b].length==0){continue}var e=document.createElement("div");orangesearch.tools.addStyleForElement(e,this.completionComponent.getCssPrefix()+this._petaleReferenceInfoCssClass+"_"+(b+1));switch(c){case"boutique":if(b==1){var d=Math.round(parseFloat(f.d["ref"]["info"][b])*2);if(d<0){d=0}else{if(d>10){d=10}}orangesearch.tools.addStyleForElement(e,this.completionComponent.getCssPrefix()+this._petaleReferenceInfoCssClass+"_"+c+"_mark");e.style.backgroundPosition="left -"+(14*d)+"px";break}default:orangesearch.tools.addStyleForElement(e,this.completionComponent.getCssPrefix()+this._petaleReferenceInfoCssClass+"_"+c+"_"+(b+1));e.innerHTML=this._getFormattedText(f.d["ref"]["info"][b],this._petaleInfoSize);break}a.appendChild(e)}},_finalizePetale:function(b,d,e,c){var a=this._identifierOfElement[d];c.parentNode.onmouseover=function(){b._disableOnBlur=true;b._highlightedSuggestionIndex=a};c.parentNode.onmouseout=function(){b._disableOnBlur=false};c.parentNode.onclick=function(){b.field.focus()};c.parentNode.style.position="absolute";c.parentNode.style.zIndex="950";c.parentNode.style.visibility="hidden"},_checkPetaleData:function(b,a){if(a){if(!b.d["ref"]||!b.d["links"]||b.d["links"].length==0){return false}}else{if(!b.d["ref"]){return false}}return true},_createPetaleWithAction:function(h,f,c,j,e){var a=false;if(typeof e=="undefined"||typeof e.type=="undefined"||typeof e.centerImage=="undefined"){wink.log("Error: petale must have a type and centerImage value");return}if(!this._checkPetaleData(j,true)){wink.log("Error: people petale must have reference and at least one action link");return}var g=this._createPetaleContainer(c,j,e.type);if(this._dataHasUrl(j.d["ref"])){a=this._getBestDataUrl(j.d["ref"])}var i=this._createPetaleReferenceContainer(c,true,a,e.type);var d=this._createPetaleReferenceSubContainer(true,e.type);i.appendChild(d);g.appendChild(i);if(j.d["ref"]["image"]){d.appendChild(this._createPetaleImage(f,j.d["ref"]["image"],e.type,e.centerImage))}else{d.appendChild(this._createPetaleImage(f,false,e.type,e.centerImage))}if(j.d["ref"]["info"]){this._createPetaleInfos(d,c,j,e.type,a)}var b=this._createPetaleActionLinks(c,j,a,e.type);g.appendChild(b);this._finalizePetale(h,c,j,g)},_createPetaleBasic:function(g,e,b,i,d){var a=false;if(typeof d=="undefined"||typeof d.type=="undefined"||typeof d.centerImage=="undefined"){wink.log("Error: petale must have a type and centerImage value");return}if(!this._checkPetaleData(i,false)){wink.log("Error: people petale must have reference and at least one action link");return}var f=this._createPetaleContainer(b,i,d.type);if(this._dataHasUrl(i.d["ref"])){a=this._getBestDataUrl(i.d["ref"])}var h=this._createPetaleReferenceContainer(b,false,a,d.type);var c=this._createPetaleReferenceSubContainer(false,d.type);h.appendChild(c);f.appendChild(h);if(i.d["ref"]["image"]){c.appendChild(this._createPetaleImage(e,i.d["ref"]["image"],d.type,d.centerImage))}else{c.appendChild(this._createPetaleImage(e,false,d.type,d.centerImage))}if(i.d["ref"]["info"]){this._createPetaleBasicInfos(i,c,d.type)}var k=document.createElement("div");k.style.clear="left";k.style.height="0px";c.appendChild(k);if(this._dataHasUrlDisplay(i.d["ref"])){var j=this._createPetaleReferenceUrl(b,i,a,d.type);h.appendChild(j)}if(a!==false){this.completionComponent.addSuggestionParam(this._idOfElement[b],"linkCount",1)}this._finalizePetale(g,b,i,f)},_createPeoplePetaleElement:function(a,c,b,e){var d={type:"people",centerImage:false};this._createPetaleWithAction(a,c,b,e,d)},_createBoutiquePetaleElement:function(a,c,b,e){var d={type:"boutique",centerImage:true};this._createPetaleWithAction(a,c,b,e,d)},_createShoppingPetaleElement:function(a,c,b,e){var d={type:"shopping",centerImage:false};this._createPetaleBasic(a,c,b,e,d)},_createMeteoPetaleElement:function(a,c,b,e){var d={type:"meteo",centerImage:false};this._createPetaleBasic(a,c,b,e,d)},hideAllPetaleElements:function(c){if(!c.uid||c.uid!=this.completionComponent.getUid()){return}if(this._petaleDivObjectContainer){this._currentPetaleId=0;this._currentPetaleLinkId=0;this._navigateInPetale=false;var a=this._petaleDivObjectContainer.children;if(a.length>0){for(var b=0;b<a.length;b++){a[b].style.visibility="hidden"}}}return true},_destroyAllPetaleElements:function(){if(this._petaleDivObjectContainer){this._petaleDivObjectContainer.innerHTML=""}},_resetPetaleData:function(){this._identifierOfElement=[];this._idOfElement=[];this._petaleDdata=[]},highLightPetaleElement:function(b){if(!wink.isInteger(b.index)){return}var a=b.index;var c=wink.byId(this._petaleContainerIdentifier+a);if(!c){this.hideAllPetaleElements(b);return}if(c.style.visibility=="visible"){return}this.hideAllPetaleElements(b);if(this._smoothShow){orangesearch.tools.setOpacity(0,this._petaleContainerIdentifier+a)}c.style.visibility="visible";if(this._smoothShow){this._upOpacityRecursive(this._smoothShowIncrement,100,this._petaleContainerIdentifier+a,this._smoothShowDelay)}},_savePositionForPetaleSuggestion:function(d){var a=d.position;var c=d.div;var b=d.data;if(!b.t||!this.isValidType(b.t)){return}this._identifierOfElement[a]=a;this._idOfElement[a]=c.id;this._petaleDdata[a]=b},_createAllPetaleElementsCall:function(a){var b=this;setTimeout(function(){b._createAllPetaleElements(a)},1)},_createAllPetaleElements:function(c){this._destroyAllPetaleElements();var d=c.position;for(var b=1;b<d;b++){var a=this._petaleDdata[b];if(!a){continue}this.createOnePetaleElement(b,a)}wink.publish("/callback/createAllPetaleElements/allPetaleElementsAdded")},_upOpacityRecursive:function(a,h,e,g){var d=wink.byId(e);if(!d){return}if(d.style.visibility=="hidden"){d.style.opacity=1;d.style.MozOpacity=1;d.style.KhtmlOpacity=1;d.style.filter="alpha(opacity="+100+")";return}var c=true;var b=d.style.opacity*100;b+=a;if(b>h){b=h;c=false}d.style.opacity=(b/100);d.style.MozOpacity=(b/100);d.style.KhtmlOpacity=(b/100);d.style.filter="alpha(opacity="+b+")";if(c==true){var f=this;setTimeout(function(){f._upOpacityRecursive(a,h,e,g)},g)}}};orangesearch.completion.plugin.Petale=Petale;var TopTrend=function(){orangesearch.completion.plugin.Plugin.call(this);new orangesearch.completion.plugin.Plugin().extendFromPlugin(orangesearch.completion.plugin.TopTrend);this.topTrendTitle="Top Requ&ecirc;te";this.topTrendMaxNbChar=false;return this};TopTrend.prototype={getTypeOfSuggestion:function(){return"top"},isValidType:function(a){return(a==this.getTypeOfSuggestion())},initProperties:function(){if(!wink.isUndefined(this.completionComponent._properties.topTrendTitle)){this.topTrendTitle=this.completionComponent._properties.topTrendTitle}if(!wink.isUndefined(this.completionComponent._properties.topTrendMaxNbChar)){this.topTrendMaxNbChar=this.completionComponent._properties.topTrendMaxNbChar}else{this.topTrendMaxNbChar=this.completionComponent.maxNbChar}},populateNewSuggestionRow:function(i,c,e,f){orangesearch.tools.addStyleForElement(c,this.completionComponent.getCssPrefix()+"AutoCompleteTopTrendSuggestion");if(f>1){var g=document.createElement("div");orangesearch.tools.addStyleForElement(g,this.completionComponent.getCssPrefix()+"AutoCompleteTopTrendBorder");c.appendChild(g)}var h=document.createElement("div");orangesearch.tools.addStyleForElement(h,this.completionComponent.getCssPrefix()+"AutoCompleteTopTrendContainer");var a=document.createElement("span");orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+"AutoCompleteTopTrendNumber");a.innerHTML=f;var d=document.createElement("span");orangesearch.tools.addStyleForElement(d,this.completionComponent.getCssPrefix()+"AutoCompleteTopTrendText");var b=e.d["request"];if(this.topTrendMaxNbChar>0){b=b.cutString(this.topTrendMaxNbChar)}d.innerHTML=b;h.appendChild(a);h.appendChild(d);c.appendChild(h);this.completionComponent.addSuggestionParam(c.id,"v",e.v);this.completionComponent.addSuggestionParam(c.id,"t",e.t);this.completionComponent.addSuggestionParam(c.id,"d",e.d)},populateNewBlockLabel:function(d,e,c){if(c=="Bottom"){this.completionComponent.populateNewBlockLabel(d,e,c);return}var b=document.createElement("span");orangesearch.tools.addStyleForElement(b,this.completionComponent.getCssPrefix()+"AutoCompleteTopTrendDate");b.innerHTML=orangesearch.tools.fullDate();var a=document.createElement("span");orangesearch.tools.addStyleForElement(a,this.completionComponent.getCssPrefix()+"AutoCompleteTopTrendLabel");if(this.completionComponent._currentBlocks[e]["label"]){a.innerHTML=this.completionComponent._currentBlocks[e]["label"]}else{a.innerHTML=this.topTrendTitle}d.appendChild(b);d.appendChild(a)},initPlugin:function(){return true}};orangesearch.completion.plugin.TopTrend=TopTrend;